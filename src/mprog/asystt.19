<PACKAGE "ASYSTAT"> 
 
<ENTRY ASYSTAT ASYUV APCT AMAX DPCT DLEN>    
 
<USE-TOTAL "ASYLUM">
 
<SETG APCT 1>
;"% ALLOCATOR FILLED"    
 
<SETG AMAX 2>
;"LARGEST FREE BLOCK OF WORDS"
 
<SETG ATOT 3>
;"TOTAL FREE WORDS" 
 
<SETG DLEN 4>
;"LENGTH OF DATA AREA"   
 
<SETG DPCT 5>
;"% DATA AREA USED" 
 
<MANIFEST APCT AMAX ATOT DPCT>
 
<SETG ASYUV <IUVECTOR 5 0>>   
 
<SETG AUV2 <IUVECTOR 2 #WORD *000000000000*>>

<DEFINE ASYSTAT (D
		 "OPTIONAL" (UV ,ASYUV)
		 "AUX" (ALLOC <* <ALLOCPAGE .D> 1024>) (DUV ,DUV1) (LENMX 0) (LENTOT 0)
		       DTOT)
	#DECL ((D) ASYLUM (ALLOC LENMX LENTOT DTOT) FIX (DUV UV) UVECTOR)
	<ALLOC-MAP .D>
	<PUT .UV
	     ,APCT
	     </ <* </ <- <CHTYPE <ORB <GETBITS <1 <GET-LOC .ALLOC .DUV>> <BITS 18 18>>
				      #WORD *777777000000*>
				 FIX>
			 2>>
		   100>
		511>>
	<REPEAT ((UV ,AUV2) (ALPTR <1 <GET-LOC .ALLOC ,DUV1>>) LEN
		 (CNT
		  <CHTYPE <ORB <GETBITS .ALPTR <BITS 18 18>> #WORD *777777000000*> FIX>)
		 (ALOC
		  <+ <CHTYPE <ANDB <GETBITS .ALPTR <BITS 18 0>> #WORD *000000001777*>
			     FIX>
		     .ALLOC>))
		#DECL ((UV) UVECTOR (ALPTR) WORD (CNT ALOC LEN) FIX)
		<GET-LOC .ALOC .UV>
		<SET LEN <CHTYPE <1 .UV> FIX>>
		<SET LENTOT <+ .LEN .LENTOT>>
		<AND <G? .LEN .LENMX> <SET LENMX .LEN>>
		<SET ALOC <+ .ALOC 2>>
		<SET CNT <+ .CNT 2>>
		<AND <0? .CNT> <RETURN>>>
	<PUT .UV ,AMAX .LENMX>
	<PUT .UV ,ATOT .LENTOT>
	<PUT .UV
	     ,DPCT
	     </ <* <CHTYPE <1 <GET-LOC <+ .ALLOC 1022> .DUV>> FIX> 100>
		<SET DTOT
		     <CHTYPE <1 <GET-LOC <+ <* <MFDPAGE .D> 1024> ,MAXADR> .DUV>>
			     FIX>>>>
	<PUT .UV ,DLEN .DTOT>> 
 
<ENDPACKAGE>   
 
