STRNG/ 1"54^?^?^?

: Patches from 1977-06-07 TS MUD54 

LSTTOF+2/ JUMPA C,701676
701676/ HRRZ C,(A)
701677/ MOVEI 0,-1
701700/ JUMPA A,LSTTOF+3
701701/ JUMPA A,LSTTOF+4

: "AVOID CIRCULARITY" 
GOTIT+2/ JUMPA B,701702
701702/ CAIE D,(C)
701703/ HRRM D,(C)
701704/ JUMPA A,GOTIT+3

PLOAD+2/ JUMPA B,701705
701705/ PUSHJ P,SQKIL
701706/ MOVE A,(P)
701707/ JUMPA A,PLOADX
701710/ JUMPA A,PLOADX+1

ELETY7+23/ JUMPA B,701711
701711/ MOVE C,3(B)
701712/ HLRE 0,C
701713/ SUB C,0
701714/ HRRE 0,(C)
701715/ JUMPE 0,ELNUVE
701716/ MOVSI A,TATOM
701717/ JUMPA A,ELETY7+24
701720/ JUMPA A,ELETY7+25

701721/ SILOC: JRST ILOC
BINDLP+17/ PUSHJ P,SILOC
SPECB2+24/ PUSHJ P,SILOC

ILCPJ+3/ JUMPA B,701722
701722/ HRRZ E,-2(P)
701723/ HRRZ E,-1(E)
701724/ CAIN E,SILOC
701725/ JRST ILOCPJ
701726/ HLRZ E,-2(B)
701727/ JUMPA A,ILCPJ+4

SCHFND+3/ JUMPA B,701730
701730/ HRRZ D,-2(P)
701731/ HRRZ D,-1(D)
701732/ CAIN D,SILOC
701733/ JRST SCHFN1
701734/ HLRZ D,(C)
701735/ JUMPA A,SCHFND+4

: Backport PATSCH 
BSETGX+1/ JUMPA B,701736
701736/ PUSHJ P,.+3
701737/ MOVEM A,(C)
701740/ JUMPA A,BSETGX+2
701741/ HLRZ 0,(C)
701742/ CAIN 0,TLOCI
701743/ SKIPL D,1(C)
701744/ POPJ P,
701745/ SKIPL E,3(D)
701746/ JRST .+3
701747/ MOVE D,E
701750/ JRST .-3
701751/ MOVEI E,1
: 0, is typo for E, as in later versions? 
701752/ MOVEM 0,C(D)
701753/ POPJ P,

FOUND1+3/ JUMPA B,701754
701754/ TLO A,.VECT.
701755/ HLLM A,-1(B)
701756/ CAIE C,(A)
701757/ JUMPA A,FOUND1+4
701760/ JUMPA A,FOUND1+5

FOUND3+2/ JUMPA B,701761
701761/ HRRI A,TVEC
701762/ SKIPGE A
701763/ HRRI A,TUVEC
701764/ MOVSI A,(A)
701765/ POP P,E
701766/ JUMPA A,FOUND3+3

CCHUTY+7/ JUMPA B,701767
701767/ SKIPGE MKTBS(B)
701770/ JRST CANTCH
701771/ HLRE C,(TP)
701772/ JUMPA A,CCHUTY+10

DSAVAC+11/ JUMPA C,701773
701773/ MOVEM 0,-1(P)
701774/ MOVE 0,40
701775/ SUBI 0,(M)
701776/ TLO 0,M
701777/ MOVEM 0,(P)
702000/ JUMPA A,DONREL
702001/ JUMPA A,DONREL+1

LOPFOO+6/ JUMPA C,702002
702002/ MOVE E,ACSAV+4
702003/ POP P,(P)
702004/ JUMPA A,LOPFOO+7
702005/ JUMPA A,LOPFOO+10

: DONREL+7 in UUOH 
703245/ MOVE A,702006
LPSVDN+3/ MOVE A,702006
702006/ 440637,,

ALSTR1-2/ JUMPE A,702007
ALSTR2+11/ JUMPE A,702007
702007/ SUB TP,722002
702008/ JRST ALSTR8

NBIND1+6/ JUMPA C,702011
702011/ MOVE SP,-4(TP)
702012/ MOVEM SP,SPSTOR+1
702013/ JUMPA A,NBIND2

: Fix GETYP with wrong register 
PGFLO1+7/ LDB E,702014
702014/ 221500,,(R)

MESOUT+2/ JUMPA B,702015
702015/ MOVEI 0,776074
702016/ HRLM 0,SQUPNT
702017/ MOVE A,FRETOP
702020/ JUMPA A,MESOUT+3

SLEEP/ JUMPA B,702021
702021/ PUSH TP,$TATOM
702022/ PUSH TP,@SLEEP-1
702023/ 2040,,INTERR
702024/ JUMPGE AB,TFA
702025/ JUMPA A,SLEEP+1

: Used by patch at 702127 
702026/ EXCH 0,(P)
702027/ TLNE 0,37
702030/ MOVNS 0,0
702031/ EXCH 0,(P)
702032/ POPJ P,

DSAVAC+2/ JUMPA C,702033
702033/ ANDI 0,-1
702034/ PUSH P,PSTO
702035/ JUMPA A,DSAVAC+3

DSAVAC+7/ HLL 0,-1(P)

NOPV+2/ JUMPA B,702036
702036/ MOVEI 0,(E)
702037/ AOBJP A,FIX2
702038/ JUMPA A,NOPV+3

NOPV-1/ JUMPA C,702041
702041/ MOVEI 0,DSTORE
702042/ JRST .-3

DOFIXE+5/ JUMPA B,702043
702043/ MOVE A,(TP)
702044/ SKIPE -6(TP)
702045/ MOVEM E,-1(A)
702046/ JUMPA A,DOFIXE+6

DOFIXE+6/ JUMPA C,702047
702047/ MOVEI E,53
702050/ HRLM E,(A)
702051/ MOVEI E,DSTORE
702052/ JUMPA A,DOFIXE+7

PACT2+4/ JUMPA B,702053
702053/ HRRZ 0,(A)
702054/ JUMPN 0,TERR16
702055/ MOVEI B,(A)
702056/ LDB A,747756
702057/ JUMPA A,PACT2+5

: Save SNAME when loading GC 
LODGC/ JUMPA B,702060
702060/ .SUSET 705770
702061/ .SUSET 700532
702062/ JUMPA A,LODGC+1
702063/ .SSNAM,,SAVSNM

: Restore SNAME when coming back from GC 
LODINT/ JUMPA B,702064
702064/ .SUSET 705770
KILGC+2/ JRST 702065
702065/ .IOPUS IMAPCH,
702066/ JUMPA A,LODINT+1

: NOPAG+11 in LDGC 
700411/ JUMPA C,702067
702067/ .IOPOP IMAPCH,
702070/ .SUSET .-5
702071/ JUMPA A,NOPAG+12

: Not used 
702072/ PUSHJ P,ICELL2
702073/ JRST 702101
702074/ HRRI C,(E)
702075/ MOVEM C,(B)
702076/ MOVEM D,1(B)
702077/ MOVSI A,TP
702100/ POPJ P,
702101/ SUBM M,(P)
702102/ PUSHJ P,ICONS
702103/ JRST MPOPJ1+1

COMCAL+15/ JUMPA B,702104
702104/ TLO C,400000
702105/ SKIPE SAVM
702106/ MOVEI C,(C)
702107/ MOVEM C,PCSAV(TB)
702110/ JUMPA A,COMCAL+16

GOJOIN+26/ JUMPA C,702111
702111/ SKIPGE PCSAV(TB)
702112/ HRLI B,400000+M
702113/ JUMPA A,GOJOIN+27

BFRAME/ JUMPA C,702114
702114/ SKIPN SAVM
702115/ HRLI A,400000+M
702116/ JUMPA A,BFRAME+1

PITYO3+3/ JUMPA C,702117
702117/ MOVEI A,PITYO4
702120/ SKIPGE 0,PCSAV(C)
702121/ HRLI A,400000
702122/ JUMPA A,PITYO3+4
702123/ JUMPA A,PITYO3+5

GOTUND+23/ JUMPA C,702124
702124/ SKIPGE PCSAV(TB)
702125/ HRLI C,400000+M
702126/ JUMPA A,GOTUND+24

: Not used 
702127/ MOVE TP,FRM
702130/ MOVE FRM,(TP)
702131/ HRLS C,-1(TP)
702132/ SUB TP,C
702133/ JRST 702026

: Not used 
702134/ 1425
702135/ JUMPGE AB,TFA
702136/ HLRZ 0,AB
702137/ CAIE 0,-2
702140/ JRST TMA
702141/ LDB B,.+3
702142/ MOVSI A,1
702143/ JRST CNTIN1
702144/ 300611,,A

: "FIXUP SOME FUNNYNESS" 
SPCUNP+6/ JUMPA B,702145
702145/ CAIN B,1
702146/ SETZM -1(TP)
702147/ MOVE B,C
702150/ JUMPA A,SPCUNP+7

BUFULL/ JUMPA C,702151
702151/ PUSH TP,$TCHAN
702152/ MOVEM D,BYTPTR(E)
702153/ JUMPA A,BUFULL+1

BUFULL+24/ JUMPA B,702154
702154/ MOVE D,BYTPTR(E)
702155/ POPJ P,

: Save E when calling CKPUR 
NOBUF1+4/ JUMPA C,702156
702156/ PUSH P,E
702157/ JSP E,CKPUR
702160/ POP P,E
702161/ JUMPA A,NOBUF1+5

: Save C/D/E when calling GETPAG 
NOBUF1+14/ JUMPA C,702162
702162/ PUSH P,C
702163/ PUSH P,D
702164/ PUSH P,E
702165/ PUSHJ P,GETPAG
702166/ .VALUE 700544
702167/ POP P,E
702170/ POP P,D
702171/ POP P,C
702172/ JUMPA A,NOBUF1+16

RESTX1+34/ JUMPA B,702173
702173/ CAIN 0,TSEG
702174/ MOVEI E,TEXP1
702175/ PUSHJ P,(E)
702176/ JUMPA A,RESTX1+35
702177/ JUMPA A,RESTX1+36

IVECT1+7/ JRST 702200
702200/ POP P,0
702201/ POP P,B
702202/ JRST IBLOK2

IBYTES+13/ JUMPA C,702203
702203/ ADD AB,737306
702204/ MOVEM AB,ABSAV(TB)
702205/ JUMPA A,IBYTES+14
702206/ JUMPA A,IBYTES+15

%CWINF+7/ PUSHJ P,SLEEPR

BYTDO1/ MOVEI A,1(B)
BYTDO1+1/ JFCL
BYTDO1+2/ AOJA 1,707704

INTOGC+1/ JFCL
INTOGC+2/ JFCL

PCREST+2/ JFCL
PCREST+3/ JFCL
PCREST+4/ JFCL

: Other possible patches:
RBLDM - JRST .+11 - this is a label in later versions


: Additional patches from 1977-07-02 TS MUD54 

VUP3+13/ JUMPA C,702207
702207/ MOVE A,1(TB)
702210/ MOVE B,A
702211/ HLRE C,B
702212/ SUB B,C
702213/ SETZM (B)
702214/ SETZM 1(B)
702215/ JUMPA A,VUP3+14
702216/ JUMPA A,VUP3+15

: Not used - for ATFIX 
702217/ ASH C,1
702220/ ADD C,1201
702221/ HRRZ C,(C)
702222/ ANDI C,777
702223/ JUMPA A,ATFIX+1
702224/ JUMPA A,ATFIX+2

TBLSET/ JFCL
TBLSET+3/ PUSH TP,$TWORD

: Modern patches 

: POP TP,TP behaves differently on non-KA 
CBYST+4/ MOVE TP,(TP)
GLOSEG-3/ MOVE TP,(TP)
FINID/ MOVE TP,(TP)
CARIT1+10/ MOVE TP,(TP)

:pdump mudsav;ts mud54
g

: From 1977-06-07 TS MUD54, after initialisation:
Don't try to reuse TTYIN/TTYOUT channels (like FRSTCH in later versions) 
763065/ .STATUS 3,B

:pdump mudsav;ts mud54
:kill
:
Init done!

