;"-*-Muddle-*-"
;"Muddle replacements for some of the RSUBRs in TELL.
These were largely inspired by the implementations in the Confusion
Muddle interpreter (ported back to Muddle 56)."

<DEFINE	TELL (S1 "OPTIONAL" (F1 ,POST-CRLF) S2 S3)
  #DECL ((S1) <PRIMTYPE STRING> (F1) FIX (S2 S3) <OR STRING FALSE>)
  <AND <NOT <0? <CHTYPE <ANDB .F1 ,PRE-CRLF> FIX>>> <CRLF>>
  <PRINTSTRING .S1 .OUTCHAN>
  ; "warn if <CHTYPE <GETBITS .F1 <BITS 18 18>> FIX> != 0?"
  <AND <ASSIGNED? S2> <PRINTSTRING .S2 .OUTCHAN>>
  <AND <ASSIGNED? S3> <PRINTSTRING .S3 .OUTCHAN>>
  <AND <NOT <0? <CHTYPE <ANDB .F1 ,POST-CRLF> FIX>>> <CRLF>>
  <SETG TELL-FLAG T>>

<DEFINE CTRL-S () <>>

;"DSKDATE - in TELMID"
;"GXUNAME - not needed on Muddle 56"
;"GET-NAME - not needed on ITS"

<DEFINE STARTER () 1>

;"GETSYS - not needed on ITS"
;"ATMFIX - in TELMID"
;"FIXSTR - in TELMID"

<DEFINE DISPATCH (NO "OPT" OV) 
  <COND (<TYPE? .NO FUNCTION SUBR>
	 <COND (<AND <ASSIGNED? OV> .OV> <APPLY .NO .OV>)
	       (ELSE <APPLY .NO >)>)
	(ELSE <ERROR "Wrong dispatch type" <TYPE .NO> .NO>)>>

<PSETG READER-STRING <STRING <ASCII 27> <ASCII 13> <ASCII 10>>>
<DEFINE READST (INBUF PROMPT ALT "AUX" S)
  <PRINC .PROMPT>
  <PRINC !\ >
  <RESET ,INCHAN>
  <SET S <READSTRING .INBUF ,INCHAN ,READER-STRING>>
  <TERPRI>
  ;<SUBSTRUC "open mailbox" 0 12 .INBUF>
  ;<SET S 12>
  .S>
;<SETG SCRIPT-CHANNEL <>>

<DEFINE TTY-INIT (ARG) T>

<DEFINE TTY-UNINIT () T>

<DEFINE EXCRUCIATINGLY-UNTASTEFUL-CODE () <>>

;"STRINGP - in TELMID"
;"PSTRING - in TELMID"
