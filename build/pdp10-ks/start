#!/bin/sh

#Defaults.
VT52=${VT52:--B -b 9600}

EXIT=:
trap "" QUIT INT TERM

started() {
    EXIT="$EXIT;stop $1 $2"
    trap "$EXIT" EXIT
    echo "$1 started, pid $2"
}

stop() {
    echo -n "Stopping $1... "
    kill "$2" 2> /dev/null
    sleep 2
    kill -9 "$2" 2> /dev/null
    echo "OK"
}

gt40() {
    (sleep 3; tools/sim-h/BIN/pdp11 build/pdp10-ks/gt40 >gt40.log 2>&1) &
    started GT40 "$!"
}

vt52() {
    (sleep 2; tools/vt05/vt52 $VT52 telnet localhost 10018 >vt52.log 2>&1) &
    started "VT52" "$!"
}

help() {
    cat <<EOF
This start script takes several command line arguments:

help - Display this help text.
gt40 - Start a GT40 emulator.
vt52 - Start a VT52 emulator.
chaosnet - Set up a local Chaosnet.

EOF

    touch out/pdp10-ks/nohelp
}

test -f out/pdp10-ks/nohelp || help

while test -n "$1"; do
    "$1"
    shift
done

tools/sims/BIN/pdp10-ks build/pdp10-ks/boot
exit 0
